# Issue Patterns

Real examples organized by issue type.

## XML Tags for Selective Searching

Use grep to find specific patterns in this file:

| Tag | Purpose | Context |
|-----|---------|---------|
| `<example>` | Full example with context, title, body, explanation | Detailed learning |
| `<titles category="...">` | Grouped titles by issue type | Quick pattern lookup |
| `<anti-pattern>` | What NOT to do | Anti-Patterns section |
| `<bad>` | Bad title/body | Inside `<anti-pattern>` |
| `<good>` | Corrected version | Inside `<anti-pattern>` |

## Full Examples with Context

<example>
<category>feature</category>
<context>
Strategic feature development tracked from design through implementation.
The team needs to observe property changes on devices to build activity tracking.
</context>
<title>Detecting changes to properties of assets</title>
<body>
The backbone of the Device Activity feature is the ability of components to
observe changes to discrete properties of each device in the customer
environment. We believe these property changes are a solid foundation upon
which we can later build further business value.

It is now time to enhance the OneLayer Bridge product with events about
discrete property changes of devices as tracked by asset-twin. In the design
document we name the first chain of event processing: change-detection service.

By the time this effort is complete, the system will have had the ability to
consume property change notifications generated by this service.

## See also

- Design document: [link]
- Related issue: #139
</body>
<why_good>
Opens with strategic motivation. Title uses present-progressive form ("Detecting").
Clear "by the time" outcome statement defines done. Links to related resources
at the end.
</why_good>
</example>

<example>
<category>bug</category>
<context>
CI linter not catching violations that local tooling catches.
Reproduction evidence included with specific patch and outputs.
</context>
<title>Golang linter fails to detect violations based on diff-patch</title>
<body>
Why didn't the linter job detect the unordered imports?

With the following patch:
```diff
diff --git a/cmd/onelayer-bridge/main.go b/cmd/onelayer-bridge/main.go
--- a/cmd/onelayer-bridge/main.go
+++ b/cmd/onelayer-bridge/main.go
@@ -31,6 +31,7 @@ import (
        "os"

        "go.onelayer.dev/v/ericsson/instrument"
+
        "go.onelayer.dev/visibility/assettwin"
```

My local golangci-lint detects the typo:

```shell
$ golangci-lint run --new-from-patch=/tmp/ofek-test.patch --path-prefix=.
cmd\onelayer-bridge\main.go:34: File is not `gci`-ed
```

But the PR did not: https://github.com/OneLayerHQ/atmosphere/actions/runs/6190003966

For more details about golangci-lint action see golangci/golangci-lint-action#795.

Before completing, the documentation should be updated accordingly:

- [ ] Update developer setup doc to include GoLand config
- [ ] Update welcome README with link to tools installation
</body>
<why_good>
Title names the failing target ("Golang linter") and describes the failure.
Clear problem statement as a question. Shows reproduction (diff, local output).
Links to failed CI for evidence. Follow-up tasks listed at end.
</why_good>
</example>

<example>
<category>architecture</category>
<context>
Architectural violation discovered during implementation work.
Proposes structural fix with reasoning for the approach.
</context>
<title>Expanding network-twin graph components into asset-twin</title>
<body>
While chasing network states across the system, we've noticed that asset-twin
currently summarises network-twin's graph into its own world view. This approach
violates the digital-twins architecture. Originally, asset-twin provides a
centralised view into the network elements, with additional enrichments. To that
end, the asset graph should reuse the same nodes from its observed network-twins.

By the time this Issue is complete, asset-twin's graph will have contained all
meaningful graph components from network-twins, in their expanded form.
Furthermore, before completing this Issue, all downstream consumers will have
been updated to respect the newly expanded component graphs.

## Why should asset-twin "copy" network-twin?

While we know that we could take an "early optimisation" approach and digest
subgraphs within the lower processing layers, this may result in more complex
code as the business logic ends up being spread across layers. Therefore, we
choose to follow more generic processing and simply compute merges and unions
across multiple network graphs.

It is understood that if lower latency is needed closer to the network edge,
we may revisit this choice. But this needs to be guided by business
requirements, rather than being performed as an early optimisation.
</body>
<why_good>
Opens with discovery context ("while chasing..."). Title uses present-progressive
("Expanding"). Explains the architectural violation. Outcome statement includes
downstream impact. Reasoning section addresses likely questions about approach.
</why_good>
</example>

<example>
<category>api-design</category>
<context>
Current API is hard to use, forcing users to improvise solutions.
Proposes better abstraction with concrete example of successful pattern.
</context>
<title>Walking digital-twin graph assemblies</title>
<body>
A digital-twin publishes graph-changes to observing parties. Alas, these
notifications are very raw and require more development effort before trivial
business features can be developed easily.

A GraphChanged message contains several changed Assembly graphs, each accessible
through the following non-trivial interface:

```go
type Assembly interface {
    AssemblyId() ComponentId
    AssemblyHash() ComponentHash
    Roots() []NodeHash
    Nodes() map[NodeHash]Value
    Value(n NodeHash) Value
    EdgesOf(n NodeHash) []NodeHash
    VisitEdges(fn func(from, to Value) bool)
}
```

This interface has two major problems:
1. It does not offer a standard traversal of the nodes of the graph, forcing
   users to improvise iteration algorithms.
2. It does not carry prior knowledge about a specific or possible tree structure.

This issue tracks the development of a visitor API for digital-twins. A good API
would allow us to extract information from specific graphs without requiring
changes to the core module. A great example of a useful visitor API is go/ast.
</body>
<why_good>
Shows current problematic API with code. Explains pain points clearly numbered.
References proven pattern (go/ast) as inspiration. Title uses gerund ("Walking").
</why_good>
</example>

<example>
<category>infrastructure</category>
<context>
CI artifacts being overwritten causing unreliable builds.
Documents the problem and proposes solutions.
</context>
<title>Testing multiple modules cannot upload multiple artefacts appropriately</title>
<body>
I've noticed that the reusable-workflows that run for each module in this
repository are overwriting each other's uploaded artefacts.

According to "Uploading to the same artifact" documentation: multiple steps,
jobs and reusable-workflows may upload to the same artefacts within a single
run. Each upload extends the files in the archive, but there's a pitfall -
files with the same name overwrite each other.

There are two potential solutions:
1. Uploading to different directories within a single artefact.
2. Uploading to multiple artefacts.
</body>
<why_good>
Title names the failing target ("Testing multiple modules") and describes the
failure. Clear problem statement with observed behavior. References documentation.
Lists potential solutions without prescribing.
</why_good>
</example>

<example>
<category>migration</category>
<context>
New documentation site ready, need to transition from in-repo docs.
Tracks migration and integration work.
</context>
<title>Linking documentation to the new docs site</title>
<body>
Now that the new docs site (onelayerhq/docs serving at https://docs.onelayer.dev)
is up and running, it is time to wholeheartedly adopt it. In this Issue we focus
on the developer guidelines at the docs/ folder.

During #142 I separated between the GitHub integration files and articles that
aim to formalise contribution to this repository. By the time this Issue is
complete, the docs site will have hosted all those articles targeting developers
and the files in this repository shall point to those migrated articles.

> [!NOTE]
> The major GitHub integration files are README.md and CONTRIBUTING.md.

A significant role of the new docs site is to serve as a centralised and
referenceable source of such articles. Pull request onelayerhq/docs#2 had
already imported the articles from the docs/ folder to the docs site.
</body>
<why_good>
Context explains what's now possible. Title uses gerund ("Linking"). References
prior work (#142). Clear outcome statement. Note clarifies what stays.
</why_good>
</example>

## Titles by Category

<titles category="feature" context="New capability, system enhancement - use present-progressive/gerund form">
<title>Detecting changes to properties of assets</title>
<title>Surfacing historical UE states</title>
<title>Encoding prefix-tree to binary form</title>
<title>Keeping a journal of property changes for querying</title>
<title>Exposing device activity to a dashboard via RESTful API</title>
</titles>

<titles category="architecture" context="Structural changes, design improvements - use present-progressive/gerund form">
<title>Expanding network-twin graph components into asset-twin</title>
<title>Transferring a digital-twin's graph</title>
<title>Walking digital-twin graph assemblies</title>
<title>Declaring concealed environment-variables of components</title>
</titles>

<titles category="bug" context="Defects, unexpected behavior - name the failing target">
<title>Golang linter fails to detect violations based on diff-patch</title>
<title>Testing multiple modules cannot upload multiple artefacts appropriately</title>
</titles>

<titles category="infrastructure" context="CI, tooling, configuration - use present-progressive/gerund form">
<title>Overriding Dependabot's default security-updates behaviour</title>
<title>Configuring GOPRIVATE for Dependabot updates</title>
<title>Stabilising container-based tests</title>
</titles>

<titles category="migration" context="Transitions, deprecations - use present-progressive/gerund form">
<title>Linking documentation to the new docs site</title>
</titles>

## Anti-Patterns

<anti-pattern>
<bad>Fix issues</bad>
<why_bad>Which issues? Title provides no information about scope or problem.</why_bad>
<good>Dashboard load times degraded after data model changes</good>
</anti-pattern>

<anti-pattern>
<bad>Add mutex to cache</bad>
<why_bad>Describes solution, not problem. Issue should explain what's wrong.</why_bad>
<good>Race condition causes stale data after cache invalidation</good>
</anti-pattern>

<anti-pattern>
<bad>How do we handle X?</bad>
<why_bad>Questions belong in Discussions, not Issues. Issues track work to be done.</why_bad>
<good>Handling X in the processing pipeline</good>
</anti-pattern>

<anti-pattern>
<bad>TODO: investigate slow queries</bad>
<why_bad>TODOs are not titles. Describe what the investigation should achieve.</why_bad>
<good>Dashboard load times degraded after data model changes</good>
</anti-pattern>

<anti-pattern>
<bad>Remove exp from Dependabot's config</bad>
<why_bad>
Task-like titles in present-simple form suggest small standalone work. These
are better tracked as task-list items within a parent issue that describes the
broader effort. The parent issue uses present-progressive and is "done when"
all tasks are checked.
</why_bad>
<good>
Migrating exp module to onelayerhq/go-exp

Parent issue body includes:
- [ ] Move module code to new repository
- [ ] Update import paths in dependent code
- [ ] Remove exp from Dependabot's config
- [ ] Archive old directory
</good>
</anti-pattern>
